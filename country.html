<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Country Jobs</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<div class="container mt-4">
  <h3 id="countryTitle"></h3>
  <div id="jobList" class="d-flex gap-3 overflow-auto"></div>

  <form id="applyForm" class="mt-4" style="max-width:400px">
    <input id="name" class="form-control mb-2" placeholder="Name" required>
    <input id="job" class="form-control mb-2" placeholder="Select Job" readonly required>
    <input id="email" class="form-control mb-2" placeholder="Email" required>
    <input id="phone" class="form-control mb-2" placeholder="Phone" required>
    <button class="btn btn-dark w-100">Apply</button>
  </form>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<!-- Firebase Init -->
<script src="js/firebase.js"></script>

<!-- Page Logic -->
<script src="js/admin.js"></script>
<!-- OR -->
<script src="js/main.js"></script>


<script>
document.addEventListener("DOMContentLoaded", () => {

  const params = new URLSearchParams(window.location.search);
  const country = params.get("country");

  const jobList = document.getElementById("jobList");
  const jobInput = document.getElementById("job");

  document.getElementById("countryTitle").innerText =
    country.toUpperCase() + " Jobs";

  db.collection("jobs")
    .where("country", "==", country)
    .onSnapshot(snapshot => {
      jobList.innerHTML = "";

      if (snapshot.empty) {
        jobList.innerHTML = "<p>No jobs available</p>";
        return;
      }

      snapshot.forEach(doc => {
        const job = doc.data();
        jobList.innerHTML += `
          <div class="card p-3 job-card"
               onclick="selectJob('${job.title}')">
            <b>${job.title}</b><br>
            ${job.emergency ? `<span class="badge bg-danger">15 Days</span>` : ""}
          </div>
        `;
      });
    });

  window.selectJob = function (title) {
    jobInput.value = title;
  };

  document.getElementById("applyForm").addEventListener("submit", async e => {
    e.preventDefault();

    await db.collection("applications").add({
      name: name.value,
      job: job.value,
      email: email.value,
      phone: phone.value,
      country: country,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("Application submitted");
    location.href = "index.html";
  });

});
</script>



</body>
</html>
