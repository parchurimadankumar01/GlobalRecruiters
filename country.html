<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Country Jobs</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<div class="container mt-4">
  <h3 id="countryTitle"></h3>
  <div id="jobList" class="d-flex gap-3 overflow-auto"></div>

  <form id="applyForm" class="mt-4" style="max-width:400px">
    <input id="name" class="form-control mb-2" placeholder="Name" required>
    <input id="job" class="form-control mb-2" placeholder="Select Job" readonly required>
    <input id="email" class="form-control mb-2" placeholder="Email" required>
    <input id="phone" class="form-control mb-2" placeholder="Phone" required>
    <button class="btn btn-dark w-100">Apply</button>
  </form>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<!-- Firebase Init -->
<script src="js/firebase.js"></script>

<!-- Page Logic -->
<script src="js/admin.js"></script>
<!-- OR -->
<script src="js/main.js"></script>


<script>
const params = new URLSearchParams(location.search);
const country = params.get("country");

countryTitle.innerText = country.toUpperCase() + " Jobs";

db.collection("jobs")
.where("country","==",country)
.onSnapshot(snap=>{
  jobList.innerHTML="";
  snap.forEach(d=>{
    const j=d.data();
    jobList.innerHTML+=`
      <div class="card p-3" style="min-width:200px;cursor:pointer"
        onclick="job.value='${j.title}'">
        <b>${j.title}</b>
        ${j.emergency?'<span class="badge bg-danger">Emergency</span>':''}
      </div>`;
  });
});

applyForm.addEventListener("submit",async e=>{
  e.preventDefault();
  await db.collection("applications").add({
    name:name.value,
    job:job.value,
    email:email.value,
    phone:phone.value,
    country,
    createdAt:firebase.firestore.Timestamp.now()
  });
  alert("Applied Successfully");
});
</script>

</body>
</html>
